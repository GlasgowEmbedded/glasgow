from collections import namedtuple

__all__ = ["devices", "devices_chipid_flashsize","devices_extended"]

CCDevice = namedtuple("CCDevice", ["name", "flash_size", "flash_word_size", "flash_page_size",
                                   "write_block_size", "write_xdata_address", "write_code_address",
								   "extended", "banked",
                                   "write_protect_sizes",
								   "flash_size_bits"])

# Flash write protect bits for CC1110x/CC251x
_8k_write_protect_sizes =   {0:0b111,  8:0x000}
_16k_write_protect_sizes =  {0:0b111, 16:0x000}
_32k_write_protect_sizes =  {0:0b111,  1:0b110, 2:0b101, 4:0b100,  8:0b011, 16:0b010, 24:0b001,  32:0b000}

# Flash write protect bits for CC243x
_243x_32k_write_protect_sizes =  {0:0b111,  2:0b110, 4:0b101, 8:0b100, 16:0b011, 32:0b010}
_243x_64k_write_protect_sizes =  {0:0b111,  2:0b110, 4:0b101, 8:0b100, 16:0b011, 32:0b010, 64:0b001}
_243x_128k_write_protect_sizes = {0:0b111,  2:0b110, 4:0b101, 8:0b100, 16:0b011, 32:0b010, 64:0b001, 128:0b000}

devices = {
    (0x01,8):   CCDevice(name="CC1110F8",  flash_size=8,  flash_word_size=2, flash_page_size=1024,
                         write_block_size=512, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_8k_write_protect_sizes,
						 flash_size_bits=None),
    (0x01,16):  CCDevice(name="CC1110F16", flash_size=16, flash_word_size=2, flash_page_size=1024,
                         write_block_size=1024, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_16k_write_protect_sizes,
						 flash_size_bits=None),
    (0x01,32):  CCDevice(name="CC1110F32", flash_size=32, flash_word_size=2, flash_page_size=1024,
                         write_block_size=1024, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_32k_write_protect_sizes,
						 flash_size_bits=None),
    (0x11,8):   CCDevice(name="CC1111F8",  flash_size=8,  flash_word_size=2, flash_page_size=1024,
                         write_block_size=512, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_8k_write_protect_sizes,
						 flash_size_bits=None),
    (0x11,16):  CCDevice(name="CC1111F16", flash_size=16, flash_word_size=2, flash_page_size=1024,
                         write_block_size=1024, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_16k_write_protect_sizes,
						 flash_size_bits=None),
    (0x11,32):  CCDevice(name="CC1111F32", flash_size=32, flash_word_size=2, flash_page_size=1024,
                         write_block_size=1024, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_32k_write_protect_sizes,
						 flash_size_bits=None),
    (0x81,8):   CCDevice(name="CC2510F8",  flash_size=8,  flash_word_size=2, flash_page_size=1024,
                         write_block_size=512, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_8k_write_protect_sizes,
						 flash_size_bits=None),
    (0x81,16):  CCDevice(name="CC2510F16", flash_size=16, flash_word_size=2, flash_page_size=1024,
                         write_block_size=1024, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_16k_write_protect_sizes,
						 flash_size_bits=None),
    (0x81,32):  CCDevice(name="CC2510F32", flash_size=32, flash_word_size=2, flash_page_size=1024,
                         write_block_size=1024, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_32k_write_protect_sizes,
						 flash_size_bits=None),
    (0x91,8):   CCDevice(name="CC2511F8",  flash_size=8,  flash_word_size=2, flash_page_size=1024,
                         write_block_size=512, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_8k_write_protect_sizes,
						 flash_size_bits=None),
    (0x91,16):  CCDevice(name="CC2511F16", flash_size=16, flash_word_size=2, flash_page_size=1024,
                         write_block_size=1024, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_16k_write_protect_sizes,
						 flash_size_bits=None),
    (0x91,32):  CCDevice(name="CC2511F32", flash_size=32, flash_word_size=2, flash_page_size=1024,
                         write_block_size=1024, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_32k_write_protect_sizes,
						 flash_size_bits=None),
    (0x85,32):  CCDevice(name="CC2430F32", flash_size=32, flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_243x_32k_write_protect_sizes,
						 flash_size_bits=None),
    (0x85,64):  CCDevice(name="CC2430F64", flash_size=64, flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=True,
                         write_protect_sizes=_243x_64k_write_protect_sizes,
						 flash_size_bits=None),
    (0x85,128): CCDevice(name="CC2430F128",flash_size=128,flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=True,
                         write_protect_sizes=_243x_128k_write_protect_sizes,
						 flash_size_bits=None),
    (0x89,32):  CCDevice(name="CC2431F32", flash_size=32, flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=False,
                         write_protect_sizes=_243x_32k_write_protect_sizes,
						 flash_size_bits=None),
    (0x89,64):  CCDevice(name="CC2431F64", flash_size=64, flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=True,
                         write_protect_sizes=_243x_64k_write_protect_sizes,
						 flash_size_bits=None),
    (0x89,128): CCDevice(name="CC2431F128",flash_size=128,flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0xf000, write_code_address=0xf000,
						 extended=False, banked=True,
                         write_protect_sizes=_243x_128k_write_protect_sizes,
						 flash_size_bits=None),
    (0xA5,32):  CCDevice(name="CC2530F32", flash_size=32, flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=False,
                         write_protect_sizes=None,
                         flash_size_bits=0b001),
    (0xA5,64):  CCDevice(name="CC2530F64", flash_size=64, flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b010),
    (0xA5,128): CCDevice(name="CC2530F128",flash_size=128,flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b011),
    (0xA5,256): CCDevice(name="CC2530F256",flash_size=256,flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b100),
    (0xB5,128): CCDevice(name="CC2531F128",flash_size=128,flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b011),
    (0xB5,256): CCDevice(name="CC2531F256",flash_size=256,flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b100),
    (0x95,32):  CCDevice(name="CC2533F32", flash_size=32, flash_word_size=4, flash_page_size=1024,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=False,
                         write_protect_sizes=None,
                         flash_size_bits=0b001),
    (0x95,64):  CCDevice(name="CC2533F64", flash_size=64, flash_word_size=4, flash_page_size=1024,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b010),
    (0x95,96):  CCDevice(name="CC2533F96", flash_size=96, flash_word_size=4, flash_page_size=1024,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b011),
    (0x8D,128): CCDevice(name="CC2540F128",flash_size=128,flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b011),
    (0x8D,256): CCDevice(name="CC2540F256",flash_size=256,flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b100),
    (0x41,128): CCDevice(name="CC2541F128",flash_size=128,flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b011),
    (0x41,256): CCDevice(name="CC2541F256",flash_size=256,flash_word_size=4, flash_page_size=2048,
                         write_block_size=2048, write_xdata_address=0x0000, write_code_address=0x8000,
						 extended=True, banked=True,
                         write_protect_sizes=None,
                         flash_size_bits=0b100),
}

# Extended devices: CC253x,CC254x
#  Require a polling wait for out->in turnaround
#  Readable flash size
#  Register shuffles (notably flash controller)
#  Locks bits at top of flash
devices_extended = set([chip_id for ((chip_id,_),device) in devices.items() if device.extended])

# Extended parts have CHIPINFO0 register to determine flash size
# Maps CHIP_ID,CHIPINFO0[4..6] to flash size in Kbytes
devices_chipid_flashsize = dict([((chip_id, device.flash_size_bits), device.flash_size) for
								 ((chip_id, _), device) in devices.items() if device.flash_size_bits != None])
